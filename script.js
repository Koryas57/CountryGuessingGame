const countryInfo = {
    "AF": {
        "name": "afghanistan",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "AO": {
        "name": "angola",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "AL": {
        "name": "albanie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "AE": {
        "name": "emirats arabes unis",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "AR": {
        "name": "argentine",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "AM": {
        "name": "armenie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "AU": {
        "name": "australie",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "AT": {
        "name": "autriche",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "AZ": {
        "name": "azerbaidjan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "BI": {
        "name": "burundi",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "BE": {
        "name": "belgique",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "BJ": {
        "name": "benin",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "BF": {
        "name": "burkina faso",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "BD": {
        "name": "bangladesh",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "BG": {
        "name": "bulgarie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "BA": {
        "name": "bosnie herzegovine",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "BY": {
        "name": "bielorussie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "BZ": {
        "name": "belize",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "BO": {
        "name": "bolivie",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "BR": {
        "name": "bresil",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "BN": {
        "name": "brunei darussalam",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "BT": {
        "name": "bhoutan",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "BW": {
        "name": "botswana",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "CF": {
        "name": "republique centrafricaine",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "CA": {
        "name": "canada",
        "region": "amerique du nord",
        "color": "#7ed321"
    },
    "CH": {
        "name": "suisse",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "CN": {
        "name": "chine",
        "region": "asie de l est",
        "color": "#d0021b"
    },
    "CI": {
        "name": "cote d'ivoire",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "CM": {
        "name": "cameroun",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "CD": {
        "name": "rd congo",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "CG": {
        "name": "republique du congo",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "CO": {
        "name": "colombie",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "CR": {
        "name": "costa rica",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "CU": {
        "name": "cuba",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "CZ": {
        "name": "republique tcheque",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "DE": {
        "name": "allemagne",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "DJ": {
        "name": "djibouti",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "DK": {
        "name": "danemark",
        "region": "scandinavie",
        "color": "#50e3c2"
    },
    "DO": {
        "name": "republique dominicaine",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "DZ": {
        "name": "algerie",
        "region": "maghreb",
        "color": "#f5a623"
    },
    "EC": {
        "name": "equateur",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "EG": {
        "name": "egypte",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "ER": {
        "name": "erythree",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "EE": {
        "name": "estonie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "ET": {
        "name": "ethiopie",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "FI": {
        "name": "finlande",
        "region": "scandinavie",
        "color": "#50e3c2"
    },
    "GA": {
        "name": "gabon",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "GB": {
        "name": "royaume uni",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "GE": {
        "name": "georgie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "GH": {
        "name": "ghana",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "GN": {
        "name": "guinee",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "GM": {
        "name": "gambie",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "GW": {
        "name": "guinea-bissau",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "GQ": {
        "name": "guinee equatoriale",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "GR": {
        "name": "grece",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "GL": {
        "name": "groenland",
        "region": "amerique du nord",
        "color": "#7ed321"
    },
    "GT": {
        "name": "guatemala",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "GY": {
        "name": "guyana",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "HN": {
        "name": "honduras",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "HR": {
        "name": "croatie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "HT": {
        "name": "haiti",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "HU": {
        "name": "hongrie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "ID": {
        "name": "indonesie",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "IN": {
        "name": "inde",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "IE": {
        "name": "irlande",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "IR": {
        "name": "iran",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "IQ": {
        "name": "irak",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "IS": {
        "name": "islande",
        "region": "scandinavie",
        "color": "#50e3c2"
    },
    "IL": {
        "name": "israel",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "IT": {
        "name": "italie",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "JM": {
        "name": "jamaique",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "JO": {
        "name": "jordanie",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "JP": {
        "name": "japon",
        "region": "asie de l est",
        "color": "#d0021b"
    },
    "KZ": {
        "name": "kazakhstan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "KE": {
        "name": "kenya",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "KG": {
        "name": "kirghizistan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "KH": {
        "name": "cambodge",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "KR": {
        "name": "coree du sud",
        "region": "asie de l est",
        "color": "#d0021b"
    },
    "KW": {
        "name": "koweit",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "LA": {
        "name": "laos",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "LB": {
        "name": "liban",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "LR": {
        "name": "liberia",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "LY": {
        "name": "libye",
        "region": "maghreb",
        "color": "#f5a623"
    },
    "LK": {
        "name": "sri lanka",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "LS": {
        "name": "lesotho",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "LT": {
        "name": "lituanie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "LU": {
        "name": "luxembourg",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "LV": {
        "name": "lettonie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "MA": {
        "name": "maroc",
        "region": "maghreb",
        "color": "#f5a623"
    },
    "MD": {
        "name": "moldavie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "MG": {
        "name": "madagascar",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "MX": {
        "name": "mexique",
        "region": "amerique du nord",
        "color": "#7ed321"
    },
    "MK": {
        "name": "macedonia",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "ML": {
        "name": "mali",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "MM": {
        "name": "myanmar",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "ME": {
        "name": "montenegro",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "MN": {
        "name": "mongolie",
        "region": "asie de l est",
        "color": "#d0021b"
    },
    "MZ": {
        "name": "mozambique",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "MR": {
        "name": "mauritanie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "MW": {
        "name": "malawi",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "MY": {
        "name": "malaisie",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "NA": {
        "name": "namibie",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "NE": {
        "name": "niger",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "NG": {
        "name": "nigeria",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "NI": {
        "name": "nicaragua",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "NO": {
        "name": "norvege",
        "region": "scandinavie",
        "color": "#50e3c2"
    },
    "NP": {
        "name": "nepal",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "OM": {
        "name": "oman",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "PK": {
        "name": "pakistan",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "PA": {
        "name": "panama",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "PE": {
        "name": "perou",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "PH": {
        "name": "philippines",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "PG": {
        "name": "papouasie-nouvelle-guinee",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "PL": {
        "name": "pologne",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "KP": {
        "name": "dem. rep. korea",
        "region": "asie de l est",
        "color": "#d0021b"
    },
    "PY": {
        "name": "paraguay",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "PS": {
        "name": "palestine",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "QA": {
        "name": "qatar",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "RO": {
        "name": "roumanie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "RW": {
        "name": "rwanda",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "EH": {
        "name": "sahara occidental",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "SA": {
        "name": "arabie saoudite",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "SD": {
        "name": "soudan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "SS": {
        "name": "soudan du sud",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "SN": {
        "name": "senegal",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "SL": {
        "name": "sierra leone",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "SV": {
        "name": "salvador",
        "region": "amerique centrale",
        "color": "#417505"
    },
    "RS": {
        "name": "serbie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "SR": {
        "name": "suriname",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "SK": {
        "name": "slovaquie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "SI": {
        "name": "slovenie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "SE": {
        "name": "suede",
        "region": "scandinavie",
        "color": "#50e3c2"
    },
    "SZ": {
        "name": "eswatini",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "SY": {
        "name": "syrie",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "TD": {
        "name": "tchad",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "TG": {
        "name": "togo",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "TH": {
        "name": "thailande",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "TJ": {
        "name": "tadjikistan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "TM": {
        "name": "turkmenistan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "TL": {
        "name": "timor-leste",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "TN": {
        "name": "tunisie",
        "region": "maghreb",
        "color": "#f5a623"
    },
    "TR": {
        "name": "turquie",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "TW": {
        "name": "taiwan",
        "region": "asie de l est",
        "color": "#d0021b"
    },
    "TZ": {
        "name": "tanzanie",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "UG": {
        "name": "ouganda",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "UA": {
        "name": "ukraine",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "UY": {
        "name": "uruguay",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "UZ": {
        "name": "ouzbekistan",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "VE": {
        "name": "venezuela",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "VN": {
        "name": "vietnam",
        "region": "asie du sud est",
        "color": "#e67e22"
    },
    "YE": {
        "name": "yemen",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "ZM": {
        "name": "zambie",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "ZW": {
        "name": "zimbabwe",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "SO": {
        "name": "somalie",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "XK": {
        "name": "kosovo",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "ZA": {
        "name": "afrique du sud",
        "region": "afrique australe",
        "color": "#ff7e00"
    },
    "NZ": {
        "name": "nouvelle-zelande",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "CL": {
        "name": "chili",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "NL": {
        "name": "pays bas",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "PT": {
        "name": "portugal",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "RU": {
        "name": "russie",
        "region": "europe de l est",
        "color": "#9013fe"
    },
    "ES": {
        "name": "espagne",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "FR": {
        "name": "france",
        "region": "europe de l ouest",
        "color": "#4a90e2"
    },
    "US": {
        "name": "etats unis",
        "region": "amerique du nord",
        "color": "#7ed321"
    },
    "GF": {
        "name": "guyane",
        "region": "amerique du sud",
        "color": "#f8e71c"
    },
    "AS": {
        "name": "samoa americaines",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "AG": {
        "name": "antigua-et-barbuda",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "BH": {
        "name": "bahrein",
        "region": "moyen orient",
        "color": "#9c27b0"
    },
    "BS": {
        "name": "bahamas",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "BL": {
        "name": "saint-barthelemy",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "BB": {
        "name": "barbade",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "KM": {
        "name": "comores",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "CV": {
        "name": "cap vert",
        "region": "afrique de l ouest",
        "color": "#b27d10"
    },
    "CW": {
        "name": "curacao",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "CY": {
        "name": "chypre",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "DM": {
        "name": "dominique",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "FM": {
        "name": "micronesie",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "GD": {
        "name": "grenade",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "GU": {
        "name": "guam",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "KN": {
        "name": "saint-christophe-et-nieves",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "LC": {
        "name": "sainte lucie",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "MF": {
        "name": "saint-martin",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "MV": {
        "name": "maldives",
        "region": "asie du sud",
        "color": "#bd10e0"
    },
    "MH": {
        "name": "marshall islands",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "MT": {
        "name": "malte",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "MP": {
        "name": "iles mariannes du nord",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "MS": {
        "name": "montserrat",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "MU": {
        "name": "ile maurice",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "NR": {
        "name": "nauru",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "PW": {
        "name": "palau",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "PR": {
        "name": "porto rico",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "PF": {
        "name": "polynesie francaise",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "SB": {
        "name": "iles salomon",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "ST": {
        "name": "sao tome et principe",
        "region": "afrique centrale",
        "color": "#ad6e2d"
    },
    "SC": {
        "name": "seychelles",
        "region": "afrique de l est",
        "color": "#f4c542"
    },
    "TO": {
        "name": "tonga",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "TT": {
        "name": "trinite et tobago",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "TV": {
        "name": "tuvalu",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "VC": {
        "name": "saint vincent et les grenadines",
        "region": "caraibes",
        "color": "#00a79d"
    },
    "VU": {
        "name": "vanuatu",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "WS": {
        "name": "samoa",
        "region": "oceanie",
        "color": "#00c8ff"
    },
    "BQBO": {
        "name": "pays bas",
        "region": "autres",
        "color": "#9e9e9e"
    },
    "FJ": {
        "name": "fidji",
        "region": "oceanie",
        "color": "#00c8ff"
    }
};

// --- Variables globales ---
let selectedCountry = null;
let score = 0;
const foundCountries = new Set();
const regionCounts = {};
const regionFound = {};
const successSound = new Audio('success.mp3');

// --- Initialisation au chargement de la page ---
window.addEventListener('load', () => {
    const countries = document.querySelectorAll('#svgContainer svg [id]');

    countries.forEach(country => {
        country.style.fill = '#eee';
        country.style.stroke = '#333';
        country.style.strokeWidth = '0.5';

        country.addEventListener('click', () => {
            selectedCountry = country;

            const info = countryInfo[selectedCountry.id?.toUpperCase()];
            if (info && info.color) {
                selectedCountry.setAttribute('data-original-fill', selectedCountry.style.fill);
                selectedCountry.style.fill = info.color;
                selectedCountry.classList.add('pending');
            } else {
                selectedCountry.style.fill = 'yellow'; // fallback
            }

            showModal();
        });
    });

    // Initialisation des compteurs régionaux
    Object.values(countryInfo).forEach(info => {
        const region = info.region;
        if (!regionCounts[region]) {
            regionCounts[region] = 0;
            regionFound[region] = 0;
        }
        regionCounts[region]++;
    });

    updateGameInfo();
});

// --- Affichage de la modal ---
function showModal() {
    document.getElementById('countryInput').value = '';
    document.getElementById('feedback').innerHTML = '';
    document.getElementById('modal').classList.add('show');
    document.getElementById('countryInput').focus();
}

// --- Masquage de la modal ---
function hideModal() {
    document.getElementById('modal').classList.remove('show');
    if (selectedCountry?.classList.contains('pending')) {
        selectedCountry.style.fill = selectedCountry.getAttribute('data-original-fill') || '#eee';
        selectedCountry.classList.remove('pending');
    }
    selectedCountry = null;
}

// --- Fermeture modal (croix + clic extérieur) ---
document.getElementById('closeModal').addEventListener('click', hideModal);
document.getElementById('modal').addEventListener('click', (e) => {
    if (e.target.id === 'modal') hideModal();
});

// --- Entrée clavier ---
document.getElementById('countryInput').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
        document.getElementById('validateBtn').click();
    }
});

// --- Validation du nom ---
document.getElementById('validateBtn').addEventListener('click', () => {
    const input = document.getElementById('countryInput').value.trim().toLowerCase();
    if (!selectedCountry) return;

    const countryId = selectedCountry.id.toUpperCase();
    const info = countryInfo[countryId];

    if (info && input === info.name.toLowerCase()) {
        if (!foundCountries.has(info.name)) {
            foundCountries.add(info.name);
            score++;
            regionFound[info.region]++;
            updateGameInfo();
        }

        selectedCountry.classList.remove('pending');
        selectedCountry.removeAttribute('data-original-fill');
        selectedCountry.style.fill = info.color || '#4caf50';
        successSound.currentTime = 0;
        successSound.play();
        triggerStarburst();
        hideModal();
    } else {
        document.getElementById('feedback').innerHTML = `
          <span style="color: crimson; font-weight: bold;">❌ Mauvaise réponse. Réessayez.</span>
        `;
    }
});

// Animation bonne réponse 

function triggerStarburst() {
    const container = document.getElementById('starburst-container');

    for (let i = 0; i < 12; i++) {
        const star = document.createElement('div');
        star.className = 'star';

        const angle = (Math.PI * 2 * i) / 12;
        const distance = 80 + Math.random() * 40;

        const x = Math.cos(angle) * distance;
        const y = Math.sin(angle) * distance;

        star.style.setProperty('--x', `${x}px`);
        star.style.setProperty('--y', `${y}px`);

        container.appendChild(star);

        setTimeout(() => {
            container.removeChild(star);
        }, 800);
    }
}


// --- Zoom & déplacement (pan) ---
let isPanning = false;
let startX = 0, startY = 0;
let currentX = -500, currentY = -200;
let scale = 1.5;

const svg = document.querySelector('#svgContainer svg');
svg.style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;

svg.addEventListener('pointerdown', (e) => {
    isPanning = true;
    startX = e.clientX - currentX;
    startY = e.clientY - currentY;
    svg.setPointerCapture(e.pointerId);
});

svg.addEventListener('pointermove', (e) => {
    if (!isPanning) return;
    currentX = e.clientX - startX;
    currentY = e.clientY - startY;
    svg.style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;
});

svg.addEventListener('pointerup', () => {
    isPanning = false;
});

let lastTouchDistance = null;

svg.addEventListener('touchmove', (e) => {
    if (e.touches.length === 2) {
        e.preventDefault();

        const [touch1, touch2] = e.touches;
        const dx = touch2.clientX - touch1.clientX;
        const dy = touch2.clientY - touch1.clientY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (lastTouchDistance) {
            const delta = (distance - lastTouchDistance) * 0.01;
            scale += delta;
            scale = Math.min(Math.max(0.5, scale), 5);
            svg.style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;
        }

        lastTouchDistance = distance;
    }
}, { passive: false });

svg.addEventListener('touchend', () => {
    lastTouchDistance = null;
});


svg.addEventListener('wheel', (e) => {
    e.preventDefault();

    const rect = svg.getBoundingClientRect();
    const offsetX = e.clientX - rect.left;
    const offsetY = e.clientY - rect.top;

    const prevScale = scale;
    const delta = e.deltaY * -0.005;
    scale += delta;
    scale = Math.min(Math.max(0.5, scale), 5);

    // Ajuste le pan pour zoomer vers le curseur
    currentX -= (offsetX / prevScale - offsetX / scale);
    currentY -= (offsetY / prevScale - offsetY / scale);

    svg.style.transform = `translate(${currentX}px, ${currentY}px) scale(${scale})`;
});


// --- Mise à jour de l'interface de jeu ---
function updateGameInfo() {
    document.getElementById('scoreDisplay').innerText = `${score} pays découverts !`;

    const regionContainer = document.getElementById('regionProgress');
    regionContainer.innerHTML = '';

    Object.entries(regionCounts).forEach(([region, total]) => {
        const found = regionFound[region] || 0;
        const color = Object.values(countryInfo).find(info => info.region === region)?.color || '#666';

        const div = document.createElement('div');
        div.className = 'regionBox';
        div.style.backgroundColor = color;
        div.innerText = `${region} : ${found} / ${total}`;
        regionContainer.appendChild(div);
    });
}
